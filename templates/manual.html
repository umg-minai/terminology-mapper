{% extends "base.html" %}

{% block title %}User Manual - Medical Term Mapper{% endblock %}

{% block content %}
<div class="content-page">
    <div class="page-header">
        <h1>üìñ Mapping Manual</h1>
        <p class="subtitle">Your guide to terminology mapping</p>
    </div>

    <div class="manual-content">
        <!-- Quick Start Section -->
        <section class="manual-section">
            <h2>üöÄ Quick Start Guide</h2>
            <div class="manual-text">
                <p>This guide explains how to map clinical concepts from the dataset to standardized terminology codes.</p>
            </div>
        </section>

        <!-- What to Enter -->
        <section class="manual-section">
            <h2>üìù What Should Be Entered in the Fields?</h2>
            <div class="manual-text">
                <p>For each clinical term (e.g., "Intensive Care Medicine"), you should enter:</p>
                
                <h3>In the Input Fields:</h3>
                <ul>
                    <li><strong>Code field:</strong> The code found in a vocabulary (e.g., <code>828881000000106</code>)</li>
                    <li><strong>Display Text field:</strong> The descriptive text for that code (e.g., <code>Intensive Care Medicine</code>)</li>
                    <li><strong>Vocabulary dropdown:</strong> The vocabulary from which the code was taken (e.g., <code>SNOMED</code>)</li>
                    <li><strong>Approximate match checkbox:</strong> Check this if the found code doesn't match exactly</li>
                </ul>
                
                <h3>Complete Example:</h3>
                <ul>
                    <li class="example-row"><span class="example-label">Term to map:</span> <span class="example-value"><strong>Intensive Care Medicine</strong></span></li>
                    <li class="example-row"><span class="example-label">Code:</span> <span class="example-value"><code>828881000000106</code></span></li>
                    <li class="example-row"><span class="example-label">Display Text:</span> <span class="example-value"><code>Intensive Care Medicine</code></span></li>
                    <li class="example-row"><span class="example-label">Vocabulary:</span> <span class="example-value"><code>SNOMED</code></span></li>
                </ul>
                
                <h3>Additional Features:</h3>
                <ul>
                    <li>Use the <strong>"+ Add Another Concept"</strong> button to add more codes for the same clinical term</li>
                    <li>Use the <strong>Comment field</strong> to explain:
                        <ul>
                            <li>Why a code does or doesn't fit</li>
                            <li>Which alternatives you examined</li>
                            <li>Why you chose an approximate match</li>
                        </ul>
                    </li>
                </ul>
            </div>
        </section>

        <!-- How to Find Codes -->
        <section class="manual-section">
            <h2>üîç How to Find the Right Code</h2>
            <div class="manual-text">
                <p><strong>Please search in the original vocabularies first:</strong></p>
                
                <h3>1. SNOMED CT Browser</h3>
                <p>üîó <a href="https://browser.ihtsdotools.org/" target="_blank" rel="noopener noreferrer">https://browser.ihtsdotools.org/</a></p>
                <ul>
                    <li><strong>Use for:</strong> Diagnoses, clinical concepts, findings, procedures</li>
                    <li><strong>Advantage:</strong> Excellent hierarchy navigation ("Is-a" relationships)</li>
                </ul>
                
                <h3>2. LOINC Search</h3>
                <p>üîó <a href="https://loinc.org/search/" target="_blank" rel="noopener noreferrer">https://loinc.org/search/</a></p>
                <ul>
                    <li><strong>Use for:</strong> Laboratory values, measurements, vital parameters</li>
                </ul>
                
                <h3>3. ICD-10 (ICD-Code.de)</h3>
                <p>üîó <a href="https://www.icd-code.de/" target="_blank" rel="noopener noreferrer">https://www.icd-code.de/</a></p>
                <ul>
                    <li><strong>Use for:</strong> Classified diagnoses in the German context (ICD-10-GM)</li>
                </ul>
                
                <h3>4. Optional: OMOP Athena ‚Äì What Is It For?</h3>
                <p>üîó <a href="https://athena.ohdsi.org" target="_blank" rel="noopener noreferrer">https://athena.ohdsi.org</a></p>
                <p>OMOP Athena is <strong>not its own vocabulary</strong>, but rather an integrated collection of many international standard vocabularies, including:</p>
                <ul>
                    <li>SNOMED CT</li>
                    <li>LOINC</li>
                    <li>ICD-10, ICD-9</li>
                    <li>HCPCS, CPT, ATC, RxNorm, UCUM, and many more</li>
                </ul>
                
                <h3>Why Athena Is Helpful:</h3>
                <ul>
                    <li>You can search additional vocabularies</li>
                    <li>It's well-suited for cross-checking your findings</li>
                </ul>
                
                <p><strong>‚ö†Ô∏è Important:</strong> Primary searches should <em>always</em> be performed in the original vocabularies, because their search functions are often better and hierarchies are fully navigable.</p>
            </div>
        </section>

        <!-- Approximate Matches -->
        <section class="manual-section">
            <h2>‚öñÔ∏è Approximate Matches</h2>
            <div class="manual-text">
                <p>Use the <strong>"Approximate match"</strong> checkbox when:</p>
                <ul>
                    <li>The found code doesn't match exactly what the term says</li>
                    <li>The code is close in meaning but not a perfect match</li>
                    <li>It's the best available option even though it's not ideal</li>
                </ul>
                <p><strong>Tip:</strong> Use the comment field to explain why you marked it as an approximate match.</p>
            </div>
        </section>

        <!-- When No Code Exists -->
        <section class="manual-section">
            <h2>üí° When No Code Exists - Proposing New Concepts</h2>
            <div class="manual-text">
                <p><strong>‚ö†Ô∏è Important:</strong> Only use the "No Code Found - Propose New Concept" button when you have thoroughly searched and cannot find an existing code in any vocabulary.</p>
                
                <h3>Before using "No Code Found":</h3>
                <ul>
                    <li>‚úÖ Search all relevant vocabularies (SNOMED CT, ICD-10, LOINC, etc.)</li>
                    <li>‚úÖ Try different search terms and synonyms</li>
                    <li>‚úÖ Consider checking OMOP Athena for additional vocabularies</li>
                    <li>‚úÖ Look for broader or narrower concepts that might fit</li>
                </ul>
                
                <h3>How to propose a new concept:</h3>
                <ol>
                    <li>Click the <strong>"No Code Found - Propose New Concept"</strong> button</li>
                    <li>Enter <strong>only a display text</strong> (description) for the proposed concept</li>
                    <li>The code field remains empty - this indicates it's a new proposal</li>
                </ol>
                
                <p><strong>Note:</strong> Proposed new concepts will be marked as vocabulary "NEW_CONCEPT" and will be reviewed separately.</p>
            </div>
        </section>

        <!-- Multiple Codes -->
        <section class="manual-section">
            <h2>üìù Adding Multiple Concepts</h2>
            <div class="manual-text">
                <p>You can add multiple codes for a single term when:</p>
                <ul>
                    <li>The clinical term encompasses multiple distinct concepts</li>
                    <li>Different aspects of the term need separate codes</li>
                    <li>Multiple codes from different vocabularies are relevant</li>
                </ul>
                <p>Click the <strong>"+ Add Another Concept"</strong> button to add additional code entries.</p>
            </div>
        </section>

        <!-- Best Practices -->
        <section class="manual-section">
            <h2>‚úÖ Best Practices</h2>
            <div class="manual-text">
                <h3>Search Strategy:</h3>
                <ul>
                    <li>Always start with the original vocabulary sources</li>
                    <li>Use multiple search terms and synonyms</li>
                    <li>Navigate through hierarchies to find related concepts</li>
                    <li>Double-check your findings in OMOP Athena</li>
                </ul>
                
                <h3>Quality Guidelines:</h3>
                <ul>
                    <li>Prefer exact matches over approximate matches</li>
                    <li>Always include the complete display text from the vocabulary</li>
                    <li>Use comments to document your decision-making process</li>
                    <li>Only mark "No Code Found" after thorough searching</li>
                </ul>
                
                <h3>Common Pitfalls to Avoid:</h3>
                <ul>
                    <li>‚ùå Don't skip the display text field - it's required for proper documentation</li>
                    <li>‚ùå Don't use "No Code Found" without exhaustive searching</li>
                    <li>‚ùå Don't forget to select the correct vocabulary</li>
                    <li>‚ùå Don't leave approximate matches unexplained</li>
                </ul>
            </div>
        </section>

        <!-- Keyboard Shortcuts -->
        <section class="manual-section">
            <h2>‚å®Ô∏è Keyboard Shortcuts</h2>
            <div class="manual-text">
                <ul>
                    <li><strong>Ctrl + Enter:</strong> Submit and continue</li>
                    <li><strong>Ctrl + N:</strong> No code found (propose new concept)</li>
                </ul>
            </div>
        </section>

        <!-- Getting Help -->
        <section class="manual-section">
            <h2>‚ùì Getting Help</h2>
            <div class="manual-text">
                <p>If you have questions or need assistance:</p>
                <ul>
                    <li>Use the <a href="/contact">contact form</a> to reach out</li>
                    <li>Check the <a href="/dashboard">dashboard</a> for your progress</li>
                </ul>
                <p><strong>[Additional content to be added]</strong></p>
            </div>
        </section>
    </div>

    <div class="manual-navigation">
        {% if user %}
            <a href="/dashboard" class="btn btn-primary">Back to Dashboard</a>
        {% else %}
            <a href="/login" class="btn btn-primary">Go to Login</a>
        {% endif %}
    </div>
</div>

<style>
.content-page {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.page-header {
    text-align: center;
    margin-bottom: 40px;
    padding-bottom: 20px;
    border-bottom: 2px solid #e2e8f0;
}

.page-header h1 {
    color: #1e293b;
    margin-bottom: 10px;
    font-size: 2.5em;
}

.subtitle {
    color: #64748b;
    font-size: 1.2em;
}

.manual-content {
    background: white;
    padding: 30px;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.manual-section {
    margin-bottom: 40px;
}

.manual-section:last-child {
    margin-bottom: 0;
}

.manual-section h2 {
    color: #1e293b;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid #e2e8f0;
}

.manual-section h3 {
    color: #334155;
    margin-top: 20px;
    margin-bottom: 10px;
}

.manual-text {
    color: #475569;
    line-height: 1.7;
}

.manual-text p {
    margin-bottom: 12px;
}

.manual-text ul, .manual-text ol {
    margin-left: 25px;
    margin-bottom: 12px;
}

.manual-text li {
    margin-bottom: 6px;
}

.manual-text code {
    background: #f1f5f9;
    padding: 2px 6px;
    border-radius: 3px;
    font-family: 'Courier New', monospace;
    font-size: 0.9em;
    color: #e11d48;
}

.manual-text a {
    color: #3b82f6;
    text-decoration: underline;
}

.manual-text a:hover {
    color: #2563eb;
}

.manual-navigation {
    text-align: center;
    margin-top: 40px;
    padding-top: 20px;
    border-top: 1px solid #e2e8f0;
}

.input-label {
    display: block;
    font-weight: 500;
    margin-bottom: 5px;
    color: #334155;
}

.input-label .help-text {
    font-weight: normal;
    color: #64748b;
    font-size: 0.9em;
}

.example-row {
    display: flex;
    gap: 20px;
    margin-bottom: 12px;
    align-items: baseline;
}

.example-row > li {
    flex: 1;
    min-width: 0;
}

.example-label {
    font-weight: 500;
    min-width: 120px;
    flex-shrink: 0;
}

.example-value {
    flex: 1;
}
</style>
{% endblock %}
